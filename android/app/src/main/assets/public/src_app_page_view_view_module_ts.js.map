{"version":3,"file":"src_app_page_view_view_module_ts.js","mappings":"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","sources":["./src/app/page/view/view-routing.module.ts","./src/app/page/view/view.module.ts","./src/app/page/view/view.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ViewPage } from './view.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ViewPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ViewPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ViewPageRoutingModule } from './view-routing.module';\n\nimport { ViewPage } from './view.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ViewPageRoutingModule\n  ],\n  declarations: [ViewPage]\n})\nexport class ViewPageModule {}\n","import { Component, OnInit } from '@angular/core';\n\n// Importa dependências\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { initializeApp } from 'firebase/app';\nimport { doc, getDoc, getFirestore, onSnapshot, orderBy, query, updateDoc, where } from 'firebase/firestore';\nimport { environment } from 'src/environments/environment';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\nimport { collection, addDoc } from 'firebase/firestore';\nimport { AlertController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-view',\n  templateUrl: './view.page.html',\n  styleUrls: ['./view.page.scss'],\n})\nexport class ViewPage implements OnInit {\n\n  // Armazena o Id do artigo vindo da rota\n  public id: string;\n\n  // Conexão com o Firebase\n  app = initializeApp(environment.firebase);\n\n  // Conexão com o banco de dadosKw\n  db = getFirestore();\n\n  // Armazena o artigo completo\n  art: any;\n\n  // Variável que armazena dados do usuário logado\n  userData: any;\n\n  // Armazena comentários\n  comment = '';\n  comments: Array<any> = [];\n\n  constructor(\n\n    // Injeta dependências\n    private activatedRoute: ActivatedRoute,\n    private route: Router,\n    public auth: AngularFireAuth,\n    public alertController: AlertController\n  ) { }\n\n  // 'ngOnInit()' deve ser 'async' por causa do 'await' usado logo abaixo!\n  async ngOnInit() {\n\n    // Obtém o ID do artigo a ser exibido, da rota (URL)\n    this.id = this.activatedRoute.snapshot.paramMap.get('id');\n\n    // Obtém o artigo inteiro à partir do ID deste\n    const myArt = await getDoc(doc(this.db, 'manual', this.id));\n\n    // Se o artigo foi encontrado...\n    if (myArt.exists()) {\n\n      // Armazena o artigo em 'art'\n      this.art = myArt.data();\n\n      // Incrementa 'views' do artigo\n      updateDoc(doc(this.db, 'manual', this.id), {\n        views: (parseInt(this.art.views, 10) + 1).toString()\n      });\n\n      // Conecta ao banco de dados e obtém todos os comentários deste artigo\n      onSnapshot(query(\n        collection(this.db, 'comment'),\n        where('article', '==', this.id),\n        where('status', '==', 'on'),\n        orderBy('date', 'desc')\n      ), (myComments) => {\n\n        // Limpa a lista de manuais para carregar novamente.\n        this.comments = [];\n\n        // Loop que itera cada faq obtida\n        myComments.forEach((myDoc) => {\n\n          // Armazena dados na variável 'faq'\n          const myComment = myDoc.data();\n\n          // Adiciona conteúdo de 'faq' em 'faqs' para ser usado na view\n          this.comments.push(myComment);\n\n        });\n\n      });\n\n\n      // Se não foi encontrado...\n    } else {\n\n      // Volta para a lista de artigos\n      this.route.navigate(['/usuarios']);\n    }\n\n    // Verifica se tem usuario logado\n    this.auth.authState.subscribe(user => {\n      if (user) {\n\n        // Armazena os dados do usuário em 'this.user'\n        this.userData = user;\n      }\n    });\n\n  }\n\n  // Salva comentários no banco de dados\n  async sendComment() {\n\n    /**\n     * Sanitiza comentário, se necessário\n     * Retirado do 'MyDocsApp' original:\n     *     https://github.com/Luferat/MyDocsApp/blob/20220119_01/global.js\n     */\n    this.comment = this.comment.replace(/<[^>]*>?/gm, '');\n    this.comment = this.comment.replace(/\\n/g, '<br>').trim();\n    this.comment = this.comment.trim();\n\n    // Se existe comentário...\n    if (this.comment !== '') {\n\n      /**\n       * Data de hoje, formatada.\n       * Retirado do 'MyDocsApp' original:\n       *     https://github.com/Luferat/MyDocsApp/blob/20220119_01/global.js\n       */\n      const yourDate = new Date();\n      const now = yourDate.toISOString().replace('T', ' ').split('.')[0];\n\n      // Formata dados para salvar no database\n      const commentData = {\n        name: this.userData.displayName, // Nome do comentarista\n        email: this.userData.email, // E-mail do comentarista\n        photo: this.userData.photoURL, // Foto do comentarista\n        uid: this.userData.uid, // ID do comentarista\n        date: now, // Data atual (UTC)\n        article: this.id, // ID do artigo que esta sendo comentado\n        comment: this.comment, // Comentário\n        status: 'on' // Status do comentário\n      };\n\n      // Tenta armazenar o comentário em um novo documento da coleção 'comment'\n      try {\n        const docRef = await addDoc(collection(this.db, 'comment'), commentData);\n\n        // Se deu certo, exibe alerta para o usuário\n        this.presentAlert();\n\n        // Limpa o campo para um novo comentário\n        this.comment = '';\n\n        // Se de errado...\n      } catch (e) {\n\n        // Exibe mensagem de erro no console.\n        console.error('Erro ao adicionar documento: ', e);\n      }\n\n    } else {\n\n      // Se não existe comentário, sai sem fazer nada.\n      return false;\n    }\n  }\n\n  // Caixa de alerta --> https://ionicframework.com/docs/api/alert\n  async presentAlert() {\n    const alert = await this.alertController.create({\n      header: 'Oba!',\n      message: 'Seu comentário foi enviado com sucesso.',\n      buttons: ['Ok']\n    });\n    await alert.present();\n  }\n\n}\n"],"names":[],"sourceRoot":"webpack:///"}